---
name: preservation-gates
description: >-
  Validate preservation gates implementation. Tests that GATE 2B
  content protection, refusal rules, checkpoint enforcement, and
  self-protection mechanisms are properly documented.
detection:
  markers:
    - pattern: "GATE 2B"
    - pattern: "NON-DELETABLE"
  logic: and  # Both markers required

tests:
  - id: gate-2b-present
    name: "GATE 2B (NON-DELETABLE list) present"
    description: "Verify that the non-deletable content list is documented"
    assertion:
      type: grep
      pattern: "GATE 2B.*NON-DELETABLE|NON-DELETABLE.*GATE 2B"
      target: "$SKILL_MD"
    enabled: true

  - id: refusal-rules
    name: "Refusal rules documented"
    description: "Ensure absolute refusal instructions are present"
    assertion:
      type: grep
      pattern: "REFUSE IMMEDIATELY|ABSOLUTE REFUSAL"
      target: "$SKILL_MD"
    enabled: true

  - id: checkpoint-enforcement
    name: "Gate checkpoint enforcement present"
    description: "Validate DO NOT PROCEED blocking between gates and editing"
    assertion:
      type: grep
      pattern: "DO NOT PROCEED.*UNTIL|UNTIL ALL GATES"
      target: "$SKILL_MD"
    enabled: true

  - id: self-protection
    name: "GATE 2B self-protection documented"
    description: "Verify that GATE 2B cannot be deleted"
    assertion:
      type: grep
      pattern: "self-protecting|GATE 2B.*itself|This.*rule.*itself"
      target: "$SKILL_MD"
    enabled: true
